<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Google + Kakao Map Sync</title>
<style>
  html, body { margin: 0; padding: 0; width: 100%; height: 100%; }
  #container { display: flex; width: 100%; height: 100%; }
  #googleMap, #kakaoMap { flex: 1; height: 100%; }

  /* 측정 결과 박스 */
  #measureResult {
      position: absolute;
      top: 10px;
      right: 20px;
      background: rgba(0,0,0,0.6);
      padding: 8px 12px;
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
      z-index: 999;
      white-space: nowrap;
  }
</style>
</head>
<body>

<div id="measureResult"></div>

<div id="container">
  <div id="googleMap"></div>
  <div id="kakaoMap"></div>
</div>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_KEY&libraries=drawing"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_KEY"></script>

<script>
let googleMap, kakaoMap, drawingManager;

function initMaps() {

    // 1) Google map
    googleMap = new google.maps.Map(document.getElementById("googleMap"), {
        center: { lat: 37.5665, lng: 126.9780 },
        zoom: 14
    });

    // 2) Kakao map
    kakaoMap = new kakao.maps.Map(document.getElementById('kakaoMap'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 5
    });

    // 3) DrawingManager 옵션
    const options = {
        map: kakaoMap,
        drawingMode: [
            kakao.maps.drawing.OverlayType.POLYLINE,
            kakao.maps.drawing.OverlayType.POLYGON
        ],
        guideTooltip: ['draw', 'drag', 'edit'],
        polylineOptions: {
            draggable: true,
            removable: true,
            strokeColor: '#ff0000',
            strokeWeight: 3
        },
        polygonOptions: {
            draggable: true,
            removable: true,
            strokeColor: '#00aaff',
            fillColor: '#00aaff',
            fillOpacity: 0.3,
            strokeWeight: 2
        }
    };

    drawingManager = new kakao.maps.drawing.DrawingManager(options);

    // 4) 측정 결과 HTML 요소
    const resultBox = document.getElementById('measureResult');

    // 5) 도형 그리기가 끝났을 때 거리/면적 계산
    kakao.maps.event.addListener(drawingManager, 'drawend', function (data) {
        let resultText = "";

        if (data.overlayType === kakao.maps.drawing.OverlayType.POLYLINE) {
            // 거리 계산
            const length = Math.round(data.distance); // 미터
            if (length < 1000) {
                resultText = `거리: ${length.toLocaleString()} m`;
            } else {
                resultText = `거리: ${(length / 1000).toFixed(2)} km`;
            }
        }

        if (data.overlayType === kakao.maps.drawing.OverlayType.POLYGON) {
            // 면적 계산
            const area = Math.round(data.area); // ㎡
            if (area < 1_000_000) {
                resultText = `면적: ${area.toLocaleString()} ㎡`;
            } else {
                resultText = `면적: ${(area / 1_000_000).toFixed(3)} ㎢`;
            }
        }

        resultBox.innerHTML = resultText;
    });

    // 6) Google → Kakao 동기화
    googleMap.addListener("idle", function () {
        const center = googleMap.getCenter();
        const zoom = googleMap.getZoom();
        kakaoMap.setCenter(new kakao.maps.LatLng(center.lat(), center.lng()));
        kakaoMap.setLevel(17 - zoom);
    });

    // 7) Kakao → Google 동기화
    kakao.maps.event.addListener(kakaoMap, 'idle', function () {
        const center = kakaoMap.getCenter();
        const level = kakaoMap.getLevel();
        googleMap.setCenter({ lat: center.getLat(), lng: center.getLng() });
        googleMap.setZoom(17 - level);
    });
}

// API 준비 확인
function checkReady() {
    if (typeof kakao === 'object' && typeof kakao.maps === 'object' &&
        typeof google === 'object' && typeof google.maps === 'object') {
        initMaps();
    } else {
        setTimeout(checkReady, 200);
    }
}
checkReady();
</script>
</body>
</html>

